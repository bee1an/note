# 为什么打包之后的文件名带有hash

这篇笔记主要记录了vite打包之后为什么资源文件都带有hash的问题

## 前景

从网站优化的角度触发, 我们发版后的文件在下一次发版之前都不会变更, 所以我们会对这些文件做[强缓存](../network/whenAccessUrl/whenAccessUrl.md#强缓存)

那么这个时候就会出现一个问题, 我们在下一次发版后, 如果缓存时间还没有过期, 那么这时候访问的还是上一次的资源文件

这个时候就有一个解决方案就是在资源文件的后面加上版本号

```html
<link rel="stylesheet" href="style.css?v=1.0.0" />
```

但是这样会导致一个问题, 假设我们有两个资源文件, 这次发版我们只修改了其中的一个文件, 但是这个时候两个文件的版本号都改了, 这样就会导致未修改的文件的缓存也失效

这时候就需要将版本号替换为hash, 那个文件修改了, 那么就只有一个文件的版本号变更 (注: 现在的打包工具, 如果被依赖的文件修改了, 那么依赖这个文件的文件的hash值也会改变, rolldown在尝试优化这个, 敬请期待)

```html
<link rel="stylesheet" href="style1.css?badfassawr" />
<link rel="stylesheet" href="style2.css?werxvsafds" />
```

如果网站的html页面和资源文件页面的部署时机都是相同的, 那么这个优化已经足够了

但是, 有的网站html文件和资源文件可能不在同一个服务器上, 那么这样的部署就会产生时间差

此时会出现两个问题

1. 先部署资源文件, 这时用户如果有缓存, 那么他会访问到缓存的内容, 此时不会有问题, 但是如果用户没有缓存, 那么他将会使用尚未部署的旧html页面请求已经部署的新的资源文件

2. 先部署html文件, 如果这时有用户访问或者刷新页面, 用户就会请求到旧的资源文件

解决办法也很简单, 我们在将资源文件的文件名中添加hash, 这样资源文件如果变更了, 他就会生成一个新的文件, 而不会覆盖旧的文件, 然后我们先部署资源文件, 再部署html文件, 这样就可以解决这个问题

这也就是为什么打包之后的文件名带有hash
