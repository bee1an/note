# 🟨 js

javascript

## 小数运算不精确的原因

计算机的一切都依赖于二进制

例如3在二进制中就是11

```js
;(3).toString(2) // ==> '11'
```

但是3.3的存储并不是11.11

如果3.3的二进制是11.11, 那么 3.3 + 3.3 转换为二进制 11.11 + 11.11 = 111.10 再转换为十进制就是 7.1, 显然3.3+3.3的结果不是7.1

如果要让计算正确, 那么在小数计算上需要一套特殊的计算规则, 既然不能修改计算方式, 那么只能修改存储方式

十进制的存储可以表示为

$314 = 3 * 10^2 + 1 * 10^1 + 4 * 10^0$

$3.14 = 3 * 10^1 + 1* 10^{-1} + 4 * 10^{-2}$

二进制的存储可以表示为

$101 = 1 * 2^2 + 0 * 2^1 + 1 * 2^0 = 5$

$10.1 = 1 * 2^1 + 0 * 2^0 + 1 * 2^{-1} = 2.5$

因为1 \* 2的任意负数次方的最后小数位都等于 5

所以二进制小数转换成十进制小数最后小数位都等于 5

也就是说只有小数位等于 5 的十进制小数才能被二进制小数精确表示

所以 0.2 不能被转换为精确的二进制小数

所以 0.2 + 0.1 !== 0.3

想要精度精确的解决方法, 使用字符串然后循环进行计算, 但是要牺牲效率

随便一提, BigInt只能解决整数太大不精确的问题
